# 종합 코드 리뷰 요약

## 개요
- 대상: `/workspace/chat-bot` 전체 프론트엔드(Vite + React) 코드
- 관찰 시점: 2025-06-10 기준 `work` 브랜치
- 리뷰 관점: 보안, 신뢰성(데이터 보존/오류 처리), 유지보수성

## 강점
- 마크다운 렌더링 구간마다 DOMPurify를 적용해 XSS를 방지하고 있음. 사용자 생성 콘텐츠와 코드 블록이 혼합될 때도 `marked` 출력에 대해 매번 `sanitize` 호출을 수행함.【F:components/MessageList.tsx†L10-L40】
- 모델 목록, 설정 값, 세션 상태 등은 로컬 상태를 일관되게 관리하고, UI 컴포넌트를 명확히 분리(헤더/사이드바/컨트롤 패널 등)하여 확장성을 높였음.【F:App.tsx†L114-L135】【F:components/ControlPanel.tsx†L9-L74】

## 주요 리스크와 개선 제안
1) **API 키 노출 위험 (심각)**  
   - `ENV_API_KEY`를 클라이언트 번들에서 직접 참조(`import.meta.env`/`process.env`). Vite 빌드 시 런타임에 노출되어 배포 자산만으로도 키가 유출될 수 있음.【F:services/geminiService.ts†L7-L17】
   - 권장: 브라우저 코드에서 기본 키를 제거하고, 서버 프록시를 통해 서명된 토큰이나 짧은 수명 키를 주입하는 방식으로 전환.

2) **로컬 저장소에 민감 정보가 평문 XOR 수준으로 저장됨 (심각)**  
   - API 키 풀을 `localStorage`에 저장하고 커스텀 XOR + `btoa` 방식으로 “암호화”하지만 키 소스(`userAgent`, `language`)가 예측 가능해 사실상 난독화 수준임.【F:App.tsx†L43-L61】【F:utils/crypto.ts†L1-L52】
   - 권장: 키는 저장하지 않거나, OS 보안 스토리지(예: `chrome.storage.session`/`navigator.credentials`)로 옮기고, 최소한 마스킹 + 만료/자동 로그아웃을 지원. 난독화 로직은 제거하거나 사용자 안내로 대체.

3) **세션 및 메시지 전체가 로컬에 무제한 적재 (중간)**  
   - 모든 대화 내용과 타임스탬프를 `localStorage`에 직렬화하여 저장하지만 크기 제한(5–10MB) 초과 시 처리나 PII 마스킹이 없음.【F:App.tsx†L26-L41】
   - 권장: 저장 크기 상한, 오래된 세션 자동 삭제, PII 필터링/경고 UI, 내보내기/삭제 기능을 추가해 데이터 축적과 개인정보 유출을 완화.

4) **API 키 오류/쿨다운 관리가 비동기 요청과 느슨하게 결합 (중간)**  
   - 키 풀에서 오류 발생 시 카운터를 올리지만, 실제 네트워크 예외가 발생해도 호출부에서 키를 회수하거나 재시도 정책이 명확하지 않아, 연속 실패 시 UX가 일관되지 않을 수 있음.【F:services/apiKeyPool.ts†L1-L40】【F:services/geminiService.ts†L73-L90】
   - 권장: 요청 레이어에서 재시도/백오프 정책을 공유하고, 키 오류 시 UI에 명시적 알림 및 자동 키 전환을 추가.

5) **빌드/테스트 커버리지 부재 (경미)**  
   - 스크립트는 `build`만 정의되어 있으며 린트/테스트 스위트가 없다. 리그레션 및 타입 안전성 검증이 부족해 유지보수 리스크가 큼.【F:package.json†L3-L24】
   - 권장: 기본 린트(`eslint`), 타입 체크(`tsc --noEmit`), 최소 단위/스냅샷 테스트를 추가하고 CI에 통합.

## 결론
- 최우선으로 **클라이언트 번들에서 기본 API 키 사용을 제거**하고, **API 키 저장 방식을 보안 스토리지 또는 비저장 정책**으로 바꾸는 것이 필요합니다. 그 다음 단계로 **세션 데이터 축적 관리**와 **빌드·테스트 체계**를 보완하면 배포 안정성과 보안 수준을 크게 높일 수 있습니다.
